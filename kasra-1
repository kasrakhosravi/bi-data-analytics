# --- Home exam GRA6020 Autumn 2017 (part 1) --- #


# --- Before you start --- # 

# You need to set set the proper working directory (with respect to this R script); 
# i.e. to the location where the data file "kid.tsv" is located. From the
# dropdown menu "Session" (in RStudio), select "Set Working Directory" and then 
# "Choose Directory..." where you locate and open the directory where you have stored 
# the file "kid.tsv".



# --- Part 1a --- #

kidData <- read.table(
  file = "kid.tsv",
  header = TRUE,
  sep = "\t"
)

kidData$MomWork <- as.factor(kidData$MomWork)

summary(kidData)

# MomAge variable seems to be evenly distributed. MomIQ variable is somehow right
# skewed. KidScore on the other hand is left skewed. For categorical variables, it
# appears that MomHighSchool variable is not evenly distributed which shows there are
# more educated mothers than mothers who did not graduate high school but it is too soon
# to judge now since high school graduation might not be the perfect indicator of
# education in the first palce. Also for MomWork variable, the data is evenly distributed
# among mothers who worked full time and mothers who did not work or worked part time
# during initial years of child's life but the data is not evenly distributed among
# all single categories of the variable.

# --- Part 1b --- #

age <- kidData$MomAge
score <- kidData$KidScore
highschool <- kidData$MomHighSchool
iq <- kidData$MomIQ
work <- kidData$MomWork

displayScatterPlot <- 
  function(predictorVar, goalVar, xlab, ylab, bg = 'grey') {
    with(kidData, plot(
      predictorVar,
      goalVar,
      cex = 2.5,
      pch = 21,
      xlab = xlab,
      ylab = ylab,
      bg = bg
    ))
    with(kidData, lines(
      smooth.spline(predictorVar, goalVar, df = 4),
      col = "red"
    ))
}

# The above function accepts 5 parameters and two of them have default values
# This makes creating scatterplots and the related trending line easier. The
#  important thing is to run the above function first so it is possible to use
# it in further stages.

displayScatterPlot(kidData$MomAge, kidData$KidScore, 'Mom Age', 'Kid Score');
displayScatterPlot(kidData$MomIQ, kidData$KidScore, 'Mom IQ', 'Kid Score');

# It is realy hard to observe a pattern in the scatterplot between MomAge and
# KidScore and the trending line is unable to predict the trend in data neither.
# As for the relationship between MomIQ and KidScore, a positive increasing relationship
# is observable and as MomIQ increases, so does the KidScore but the increase rate
# is stronger in the beginning and as we approach the IQ level of 100, the increase
# in KidScore tends to become more flat.

# --- Part 1c --- #

displayBoxPlot <- function(x,y, xlab=NULL, ylab=NULL) {
  with(kidData, boxplot(
    x ~ y,
    horizontal = TRUE,
    xlab = xlab,
    ylab = ylab
))}

displayBoxPlot(kidData$KidScore, kidData$MomHighSchool, 'Kid Score', 'Mom High School');
displayBoxPlot(kidData$KidScore, kidData$MomWork, 'Kid Score', 'Mom Work Type');

# One observable relationship is that for mom's with high school education,
# the median of Kid's test score is much higher than the category of mom's
# without any high school education.

# The visible relationship between work type levels and kid score is that
# the median for moms who did not work in first three years of child's life
# is lower than all of the other categories.

# --- Part 1d --- #

calcCor <- function(x, y, rndNum=5) {
  round(cor(
    kidData[c(x,y)]
  ), rndNum)
}

calcCor('MomIQ', 'MomAge');
# The corelation between MomIQ and Age is clse to 9% which does not seem
# that strong.

# --- Part 1e --- #

displayBoxPlot(kidData$MomIQ, kidData$MomHighSchool, 'Mom IQ', 'Mom High School');
displayBoxPlot(kidData$MomIQ, kidData$MomWork, 'Mom IQ', 'Mom Work');

# In the first sight, the boxplots show that women who worked either full time or part
# time and also attended high school have a higher IQ compared to the other group.

# --- Part 1f --- #
with(kidData, plot(MomWork, MomHighSchool))

# The plot shows us that for categories of women who have worked either full time
# or part time, the high school graduation percentage is much higher compared to
# women who did not work for the few years of child's life.

# --- Part 1g --- #

# Although it is difficult in the exploration stage to say with certainity
# that which predictor is the strongest only using visual diagrams and no
# quantitative measurements, but it seems that MomIQ has a slightly strong 
# relationship with KidScore.

# --- Part 1h --- #

calcLm <- function(prdctVar, goalVar, prdctVar2=NULL, prdctVar3=NULL, prdctVar4=NULL) {
  with(kidData, lm(
    if (is.null(prdctVar2) && is.null(prdctVar3) && is.null(prdctVar4)) {
      goalVar ~ prdctVar
    } else if (is.null(prdctVar3) && is.null(prdctVar4)) {
      goalVar ~ prdctVar + prdctVar2
    } else if (is.null(prdctVar4)) {
      goalVar ~ prdctVar + prdctVar2 + prdctVar3
    } else {
      goalVar ~ prdctVar + prdctVar2 + prdctVar3 + prdctvar4
    }
  ))
}

displayLm <- function(prdctVar, goalVar, xlab, ylab) {
  displayScatterPlot(goalVar, prdctVar, xlab, ylab);
  lm <- calcLm(goalVar, prdctVar);
  abline(lm, col='red');
  summary(lm);
}

ScoreHighSchoolLm <- with(kidData, lm(
  KidScore ~ MomHighSchool
))

summary(ScoreHighSchoolLm)

# R adjusted R square is around 5.39 %

# --- Part 1i --- #

kidData$Residuals <- rstandard(ScoreHighSchoolLm);
kidData$Predicted <- predict(ScoreHighSchoolLm);

with(kidData, plot(
  Predicted, 
  Residuals,
  cex = 1.5,
  pch = 21,
  col = kidData$MomHighSchool
))

abline(0,0)

legend('top', 
       legend = levels(kidData$MomHighSchool),
       col = 1:3,
       cex = 0.8,
       pch = 1)

# The residual looks like two columns of point because it is showing
# the residual plot of a categorical variable (MomHighSchool) related to
# the kidScore which has two levels.

# --- Part 1j --- #

ScoreHighSchoolIQLm <- with(kidData, lm(
  KidScore ~ MomHighSchool + MomIQ
))

summary(ScoreHighSchoolLm)$adj.r.squared
summary(ScoreHighSchoolIQLm)$adj.r.squared

# It is clear that the R Adjusted Square significantly improved when the new
# variable (MomIQ) was added to model (Increased from 5.4% to 21 %). It is safe
# to assume that model j explains the data better because if the new added variable
# was insignificant in explaining the data better, the model would have penalized
# the R Adjusted Square value but as we have seen this value got improved.

# --- Part 1k --- #

ScoreHighSchoolIQInteractionLm <- with(kidData, lm(
  KidScore ~ MomHighSchool + MomIQ + MomHighSchool:MomIQ
))

summary(ScoreHighSchoolIQLm)$adj.r.squared
summary(ScoreHighSchoolIQInteractionLm)$adj.r.squared

summary(ScoreHighSchoolIQInteractionLm)

# The interaction term is slightly significant in terms of p-value and also
# as a result improved R Adjusted Square from 21% to 22%. This improvement
# can be seen differently for different contexts. An improvement is always nice
# but its associated cost needs to be considered as well. We might say that this
# small improvement is not worth the risk of making the model more complicated by adding
# a new variable.

# --- Part 1l --- #

ScoreHighSchoolIQInteractionWorkLm <- with(kidData, lm(
  KidScore ~ MomHighSchool + MomIQ + MomHighSchool:MomIQ + MomWork
))

summary(ScoreHighSchoolIQInteractionLm)$adj.r.squared
summary(ScoreHighSchoolIQInteractionWorkLm)$adj.r.squared

summary(ScoreHighSchoolIQInteractionWorkLm)

# Althoug by adding the variable MomWork, Adjusted R Square gets improved by a relly
# small number, but this is defianetely not worth including in the model since the
# related p values for MomWork variable are all insignificant (More than 5%) and they
# make the model more complicated without offering any value in terms of explaining
# the data better.

# --- Part 1m --- #

summary(ScoreHighSchoolIQInteractionLm)

# High School Specific Equation: KidScore = 39.78 + 0.48MomIQ
# No High School Specific Equation: KidScore = -11.48 + 0.96MomIQ

# --- Part 1n --- #

with(kidData, plot(
  MomIQ, KidScore,
  col = MomHighSchool
))

legend('bottomright', 
       legend = levels(kidData$MomHighSchool),
       col = 1:3,
       cex = 0.8,
       pch = 1)

# High School Specific Equation
curve(39.78 + 0.48 * x, add = TRUE, col = 'red');

# No High School Specific Equation
curve(-11.48 + 0.96 * x, add = TRUE);

# I think the dataset is slightly varied for the cateogry of MomIQ without any
# highschool education but the predicted line seems to show the trend correctly
# as it is increasing. On the other hand, my belief is that the predicted line
# for the other category (MomIQ with high school education) is understimating the
# values for a majority of points but then again it correctly adjusts itself to the
# dataset. It is worth mentioning that that getting any concrete evidence just by
# observing scatterplots is not possible.

# --- Part 1o --- #

kidData$Residuals <- rstandard(ScoreHighSchoolIQInteractionLm);
kidData$Predicted <- predict(ScoreHighSchoolIQInteractionLm);

with(kidData, plot(
  Predicted, 
  Residuals,
  cex = 1.5,
  pch = 21,
  bg = "darksalmon"
))

abline(0,0)

# The plot looks more or less liek a white-noise and does not seem to follow
# any specific pattern which is a good news for us. The variance between points
# is wide in the beginning, then it gets more dense and again becomes more wide.
# This can be an indicator the the residuals which should represent randomness or
# white noise in the dataset are not following any visible pattern.

# --- Part 1p --- #
